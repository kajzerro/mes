${this._shouldRender('margin') ? html`
    <!-- Show single margin field ONLY when changeMarginInPeriods is NOT checked -->
    ${!this.modelValue.changeMarginInPeriods ? html`
        <div class="row">
            <div class="col-4 form-label">
                <p> ${this.modelValue.productType === 'multiproductCreditFacility'
                    ? html` <strong> ${this.localize('ProductParameters.multiProductAgreement_revolvingLoanMargin')} </strong> `
                    : html` ${this.localize('ProductParameters.margin')} `}
                </p>
            </div>
            <div class="col-8">
                <div class="input-container margin">
                    <x2-input-amount
                        at-id="margin"
                        .modelValue=${checkTypeAndParseNumeric(this.modelValue.margin)}
                        label=""
                        class="short-input"
                        modelKey="margin"
                        currency="PLN"
                        .formatOptions=${{
                            minimumFractionDigits: FOUR_DECIMALS_PLACES_NUMBER,
                            maximumFractionDigits: FOUR_DECIMALS_PLACES_NUMBER,
                        }}
                        .errorValidators="${[
                            requiredField(this.modelValue.productType, 'margin'),
                            negativeValueValidator(this.modelValue.margin),
                            defaultPercentValidator(),
                        ]}"
                        .disabled=${this.isDisabled({ sectionName: 'priceTermsSection', propName: 'margin' })}
                        @model-value-changed=${this.updateValue}
                    ></x2-input-amount>
                    <p class="percent">%</p>
                </div>
            </div>
        </div>
    ` : ''}
` : ''}

<!-- NEW: Checkbox "Zmień wysokość marży w poszczególnych okresach" -->
${this._shouldRender('changeMarginInPeriods') ? html`
    <div class="row">
        <div class="col-4"></div>
        <div class="col-8">
            <div class="checkbox-tooltip-container">
                <ing-checkbox
                    at-id="changeMarginInPeriods"
                    name="changeMarginInPeriods"
                    label="${this.localize('ProductParameters.changeMarginInPeriods') || 'Zmień wysokość marży w poszczególnych okresach'}"
                    ?checked=${this.modelValue.changeMarginInPeriods}
                    @change=${() => this.changeBooleanProp('changeMarginInPeriods')}
                    .disabled=${this.isDisabled({ sectionName: 'priceTermsSection', propName: 'changeMarginInPeriods' })}
                ></ing-checkbox>
            </div>
        </div>
    </div>

    <!-- Margin periods (Okres 1, Okres 2) shown when checkbox is checked -->
    ${this.modelValue.changeMarginInPeriods ? this._renderMarginPeriods() : ''}
` : ''}
